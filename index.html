<html xmlns="http://www.w3.org/1999/xhtml">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <head>
    <title>CartoCiudadExplorer by JGG. Powered by: OpenLayers and DHTMLX. Special thanks to "Cowboy" Ben Alman and Mozilla Developer Network</title>

    <style type="text/css">
    
        html, body {
            width: 100%;
            height: 100%;
            margin: 0px;
            overflow: hidden;
        }

        #map{position:absolute; width:100%; height:100%;}
        
        .detail{margin:5px;}
        
    </style>
	<!--http://dhtmlx.com/docs/products/visualDesigner/live/#83fb84-->
    <!--A�adimos libreria proj4js-->
    <script src="../api/proj4js-1.1.0/lib/proj4js-compressed.js"></script>
    <!--A�adimos definici�n de sistemas de coordenadas-->
    <script src="ign/js/srsDefsProj4js.js"></script>
    <!--A�adimos libreria Openlayers-->
	<script src="../api/OpenLayers-2.12/OpenLayers.debug.js"></script>
    <!--A񡤩mos libreria jworkflow-->
	<script src="../api/jWorkflow-0.7.0/lib/jWorkflow.js"></script>
    <!--A�adimos la customizacion del layerswitcher-->
	<script src="ign/lib/LayerSwitcher.js"></script>
    <!--A�adimos las funciones para la gestion de cambio del sistema de coordenadas del map-->
    <script src="ign/js/cambioSRSMap.js"></script>
    <!--A�adimos las funciones para la gestion de cambio del sistema de coordenadas del map-->
    <script src="ign/js/XMLTree.js"></script>
	<!--A�adimos el buscadorForm-->
	<script src="ign/js/BuscadorForm.js"></script>
    <!--A񡤩mos la posibilidad de mostrar un dialogo para introducir capas nuevas-->
    <script src="ign/js/AddLayerDialogsingleton.js"></script>
    <!--A񡤩mos la posibilidad de mostrar resultados-->
    <script src="ign/js/resultsArea.js"></script>
    <!--Proceso de json de un xml a un geojson-->
    <script src="ign/js/util.js"></script>
    <!--Proceso de json de un xml a un geojson-->
    <script src="ign/js/wpsClient.js"></script>

	<!--A�adimos la posibilidad de hacer un layout -->
    <link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxLayout/codebase/dhtmlxlayout.css" />
    <link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxLayout/codebase/skins/dhtmlxlayout_dhx_skyblue.css" />
    <script src="../api/dhtmlx-3.5/dhtmlxLayout/codebase/dhtmlxcommon.js"></script>
    <script src="../api/dhtmlx-3.5/dhtmlxLayout/codebase/dhtmlxcontainer.js"></script>
    <script src="../api/dhtmlx-3.5/dhtmlxLayout/codebase/dhtmlxlayout.js"></script>
     
	<!--A�adimos la posibilidad de mostrar ventanas dhtmlx -->
    <link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxWindows/codebase/dhtmlxwindows.css">
    <link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxWindows/codebase/skins/dhtmlxwindows_dhx_skyblue.css">
    <script src="../api/dhtmlx-3.5/dhtmlxWindows/codebase/dhtmlxcommon.js"></script>
    <script src="../api/dhtmlx-3.5/dhtmlxWindows/codebase/dhtmlxcontainer.js"></script>
    <script src="../api/dhtmlx-3.5/dhtmlxWindows/codebase/dhtmlxwindows.js"></script>
    
	<!--A�adimos la posibilidad de mostrar tabbar dhtmlx     -->
    <link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxTabbar/codebase/dhtmlxtabbar.css">
    <script  src="../api/dhtmlx-3.5/dhtmlxTabbar/codebase/dhtmlxcommon.js"></script>
    <script  src="../api/dhtmlx-3.5/dhtmlxTabbar/codebase/dhtmlxtabbar.js"></script>    
    
	<!--A�adimos la posibilidad de mostrar formularios dhtmlx -->
    <link rel="stylesheet" type="text/css" href="./../api/dhtmlx-3.5/dhtmlxForm/codebase/skins/dhtmlxform_dhx_skyblue.css">
    <script src="../api/dhtmlx-3.5/dhtmlxForm/codebase/dhtmlxcommon.js"></script>
    <script src="../api/dhtmlx-3.5/dhtmlxForm/codebase/dhtmlxform.js"></script>    
    
	<!--A�adimos la posibilidad de mostrar el boton 0|1 a los formularios y las imagenes -->
	<script src="../api/dhtmlx-3.5/dhtmlxForm/codebase/ext/dhtmlxform_item_btn2state.js"></script>	
	<style type="text/css">
		/* toggle-style checkbox */
		/* enabled, not checked */
		.dhxform_obj_dhx_skyblue div.dhxform_img.btn2state_0 {
			background-image: url("img/toggle_off.png");
			width: 42px;
			height: 20px;
			}
		/* enabled, checked */
		.dhxform_obj_dhx_skyblue div.dhxform_img.btn2state_1 {
			background-image: url("img/toggle_on.png");
			width: 42px;
			height: 20px;
		}
	</style>

	<!--A�adimos la posibilidad de mostrar combos dhtmlx -->
    <script src="../api/dhtmlx-3.5/dhtmlxCombo/codebase/dhtmlxcombo.js"></script>
    <link rel="STYLESHEET" type="text/css" href="../api/dhtmlx-3.5/dhtmlxCombo/codebase/dhtmlxcombo.css">
	<!--A�adimos la posibilidad de mostrar el combo a los formularios     -->
    <script src="../api/dhtmlx-3.5/dhtmlxForm/codebase/ext/dhtmlxform_item_combo.js"></script>
	<!--A񡤩mos la posibilidad de fijar el tamaño de la lista desplegable  -->
    <script src="../api/dhtmlx-3.5/dhtmlxCombo/codebase/ext/dhtmlxcombo_whp.js"></script>
    
	<!--A�adimos la posibilidad de mostrar arboles dhtmlx -->
    <link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxTree/codebase/dhtmlxtree.css">
    <script src="../api/dhtmlx-3.5/dhtmlxTree/codebase/dhtmlxtree.js"></script>   
    
	<link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxAccordion/codebase/skins/dhtmlxaccordion_dhx_skyblue.css">		
	<script src="../api/dhtmlx-3.5/dhtmlxAccordion/codebase/dhtmlxaccordion.js"></script>
    
    <link rel="STYLESHEET" type="text/css" href="../api/dhtmlx-3.5/dhtmlxDataView/codebase/dhtmlxdataview.css">				
	<script src="../api/dhtmlx-3.5/dhtmlxDataView/codebase/dhtmlxdataview.js"></script>

	<!--Configuramos el skin y las imagenes-->
    <script>
		dhtmlx.skin='dhx_skyblue';
		dhtmlx.image_path = '../api/dhtmlx-3.5/todoEnUno/codebase/imgs/';
	</script>

	<!--Añadimos la posibilidad de mostrar menus -->
	<script src="../api/dhtmlx-3.5/dhtmlxMenu/codebase/dhtmlxmenu.js"></script>
	<link rel="stylesheet" type="text/css" href="../api/dhtmlx-3.5/dhtmlxMenu/codebase/skins/dhtmlxmenu_dhx_skyblue.css">    

	
    <!--compatibility-->
    <script src="ign/js/compatibility.js"></script>
    
    <script type="text/javascript">

        var map, layer, info, layerinfo;
        OpenLayers.ProxyHost = 'ba-simple-proxy.php?mode=native&url=';
        var proxyHost = 'ba-simple-proxy.php';
        var proxyHostOptions = 'mode=native';
        
        function init(){
        
            var lon = -4.10169;
            var lat = 40.96766;
            var zoom = 0;
            
			var mapOptions = {
                maxResolution: 0.0439453125, 
                maxExtent: new OpenLayers.Bounds(-180,-90,180,90),
                numZoomLevels: 16,
                allOverlays: true,
                projection: 'EPSG:4258',
                reproject: false,
                eventListeners: { moveend: zoomPanManage } };
			
            map = new OpenLayers.Map( 'map', mapOptions);

            var layer = new OpenLayers.Layer.WMS( "PNOA WMS",
                    "http://www.idee.es/wms/PNOA/PNOA",
                    {layers: 'pnoa'}, {visibility:false});
            map.addLayer(layer);
            layer.isBaseLayer = false;
            layer.maxResolution = 8.58306884765625e-005;
            layer.minResolution = 1.3411045074462891e-006;
            layer.alwaysInRange = true;
            //layer.initResolutions();
           
            infolayers = new Array();
            infolayers[0] = layer;

            layer = new OpenLayers.Layer.WMS( "CC WMS DivisionTerritorial",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'DivisionTerritorial', transparent: 'true'}, {visibility:false} );
			map.addLayer(layer);
			
            layer = new OpenLayers.Layer.WMS( "CC WMS FondoUrbano",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'FondoUrbano', transparent: 'true'}, {visibility:false} );
            map.addLayer(layer);
            
            layer = new OpenLayers.Layer.WMS( "CC WMS SeccionCensal",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'SeccionCensal', transparent: 'true'}, {visibility:false} );
            map.addLayer(layer);
			
 			layer = new OpenLayers.Layer.WMS( "CC WMS CodigoPostal",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'CodigoPostal', transparent: 'true'}, {visibility:false} );
            map.addLayer(layer);

            layer = new OpenLayers.Layer.WMS( "CC WMS Vial",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'Vial', transparent: 'true'}, {visibility:false} );
            map.addLayer(layer);

            layer = new OpenLayers.Layer.WMS( "CC WMS Portal",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'Portal', transparent: 'true'}, {visibility:false} );
            map.addLayer(layer);
			
            layer = new OpenLayers.Layer.WMS( "CC WMS Toponimo",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'Toponimo', transparent: 'true'}, {visibility:false} );
            map.addLayer(layer);
			

            layer = new OpenLayers.Layer.WMS( "CC WMS-C Todas",
                    "http://www.cartociudad.es/wms-c/CARTOCIUDAD/CARTOCIUDAD",
                    {layers: 'Todas', transparent: 'true'}, {visibility:true} );
			map.addLayer(layer);
			
            map.baseLayer = layer;
            
            var kk = new OpenLayers.Layer.WMS("DivTerrInfo",
                    "http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD", 
                    {'layers': 'DivisionTerritorial', transparent: true, format: 'image/png'},
                    {isBaseLayer: false});
            map.addLayer(kk);
            
            info = new OpenLayers.Control.WMSGetFeatureInfo({
                url: 'http://www.cartociudad.es/wms/CARTOCIUDAD/CARTOCIUDAD', 
                layers: [kk],
                title: 'Identify features by clicking',
                queryVisible: true,
                eventListeners: {
                    getfeatureinfo: function(event) {
                        map.addPopup(new OpenLayers.Popup.FramedCloud(
                            "chicken", 
                            map.getLonLatFromPixel(event.xy),
                            null,
                            event.text,
                            null,
                            true
                        ));
                    }
                }
            });
            map.addControl(info);
            info.activate();            
            
            
            map.addControl(new es.IGN.LayerSwitcher());
            map.addControl(new OpenLayers.Control.MousePosition());

            map.setCenter(new OpenLayers.LonLat(lon, lat), zoom);
            
        }
            
        var dhxLayout;
		dhtmlx.image_path='../api/dhtmlx-3.5/todoEnUno/codebase/imgs/';  

        dhtmlxEvent(window,'load',function(){

        	init();
        	
        	
            var main_layout = new dhtmlXLayoutObject(document.body, '3T');

            var buscador = main_layout.cells('a');
            buscador.setHeight('50');
            buscador.hideHeader();
            buscador.fixSize(0,1);
			Buscador.singleton.initialize(buscador, map);            
			
            var resultados = main_layout.cells('b');
            resultados.setWidth('400');
            resultados.hideHeader();
            resultados.fixSize(0,1);
            resultsArea.singleton.initialize(resultados, map);

            var mapa = main_layout.cells('c');
            mapa.hideHeader();
			mapa.fixSize(1,1);			
            mapa.attachObject('map');
            map.updateSize();
            wpsClient.singleton.initialize(map);
        	        	
            main_layout.attachEvent('onResizeFinish',function(){ map.updateSize();});
            main_layout.attachEvent('onPanelResizeFinish',function(){ map.updateSize();});
            main_layout.attachEvent('onExpand',function(){ map.updateSize();});
            main_layout.attachEvent('onCollapse',function(){ map.updateSize();});
        });   

    </script>
  </head>

  <body>

    <div id="map" style="z-index: 1; position: absolute">
        <div id="inProgress" style="background-color:white; width:100px; height:50px; border-radius:10px; position:absolute; left:50%; top:10px; z-index:5000; visibility:hidden">
            <img width="32px" height="32px" src="img/ajax-loader.gif" style="position:absolute; left:34px; top:9px">
        </div>
    </div>
    <div style="WIDTH:100%;HEIGHT:100%;overflow:auto;" id="detail" name="detail"></div>
   </body>
</html>